model Person {
    fields {
        name Text
        gender Text
        niNumber Text @unique
        identity Identity?
        ctxNow Timestamp?
        slackId Text?
    }

    actions {
        get getPerson(id) @function
        get getPersonByNiNumber(niNumber) @function
        create createPerson() with (name, gender, niNumber, slackId?) @function
        create createPersonWithContextInfo() with (name, gender, niNumber) @function
        list listPeople(gender) @function
        delete deletePerson(id) @function
        update updatePerson(id) with (name, gender, niNumber) @function
        create createPersonWithEnvVar() with (name, gender, niNumber) @function
        create createPersonWithSecret() with (name, gender, niNumber) @function
        create customPermission() with (name, gender, niNumber) @function
    }

    @permission(
        expression: true,
        actions: [create, get, list, update, delete]
    )
}

model Profile {
    fields {
        person Person
    }

    actions {
        create createProfile() with (person.id) @function
        create createProfileWithNullPerson() @function
    }

    @permission(
        expression: true,
        actions: [create]
    )
}

model Publisher {
    fields {
        name Text
        authors Author[]
    }

    actions {
        get getPublisherByBook(bookId: ID) @function
    }
    
    @permission(
        expression: true,
        actions: [get]
    )
}

model Author {
    fields {
        name Text
        publisher Publisher?
        books Book[]
    }
}

model Book {
    fields {
        author Author
        title Text
    }

    actions {
        list listBooksByPublisherName(author.publisher.name) @function
    }

    @permission(
        expression: true,
        actions: [list]
    )
}

api Web {
    models {
        Person
    }
}
