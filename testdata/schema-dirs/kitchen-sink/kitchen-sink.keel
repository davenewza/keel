role Admin {
    domains {
        "hello.com"
    }

    emails {
        "someagencyguy@blah.com"
    }
}

model Profile {
    fields {
        identity Identity
        username Text {
            @unique
        }
    }

    operations {
        create createProfile(username) {
            @set(profile.identity = ctx.identity)
        }
        get myProfile() {
            @where(profile.identity = ctx.identity)
        }
        get profile(id)
        update updateUsername(username) {
            @where(profile.identity = ctx.identity)
        }
    }

    @permission(
        expression: true,
        actions: [create, get, update]
    )
}

model Post {
    fields {
        body Text
        author Profile
    }

    operations {
        create createPost(body, author) {
            @permission(
                expression: post.author.identity == ctx.identity,
                actions: [create],
                role: Admin
            )
        }
        list listPosts()
        get getPost(id)
    }

    @permission(
        expression: ctx.identity != null,
        actions: [list, get]
    )
}

api Web {
    @graphql

    models {
        Profile
        Post
    }
}
