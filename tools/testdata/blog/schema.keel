// Visit https://docs.keel.so/ for documentation on how to get started
model Comment {
    fields {
        author Identity
        parent Post
        content Text
    }
    actions {
        list listComments(parent.id?)
    }
}

model Category {
    fields {
        name Text
    }
    actions {
        get getCategory(id)
        delete deleteCategory(id)
        list listCategories()
    }

}

model Post {
    fields {
        title Text
        description Text
        content Markdown
        published Boolean @default(false)
        author Identity?
        image File?
        tags Text[]?
        category Category?
        comments Comment[]
    }

    actions {
        get getPost(id) 
        update updatePost(id) with (title?, description?, content?,  tags?, image?, category.id?)
        create createPost() with (title, description, content, tags?, image?, category.id?) {
            @set(post.author = ctx.identity)
        }
        list listPosts() {
            @sortable(title)
        }
        list listPostsEmbeds() {
            @embed(author)
            @embed(category)
        }
        write createFromImage(image) returns (Any) {
            @permission(expression:true)
        }
        delete deletePost(id)
    }

    @permission(
        actions: [create, get, list, update, delete],
        expression: true
    )
}
